// Code generated by Fern. DO NOT EDIT.

package boarding_merchant_platforms_test

import (
	bytes "bytes"
	context "context"
	json "encoding/json"
	payroc "github.com/payroc/payroc-sdk-go"
	boarding "github.com/payroc/payroc-sdk-go/boarding"
	client "github.com/payroc/payroc-sdk-go/client"
	option "github.com/payroc/payroc-sdk-go/option"
	require "github.com/stretchr/testify/require"
	http "net/http"
	testing "testing"
)

func VerifyRequestCount(
	t *testing.T,
	testId string,
	method string,
	urlPath string,
	queryParams map[string]string,
	expected int,
) {
	WiremockAdminURL := "http://localhost:8080/__admin"
	var reqBody bytes.Buffer
	reqBody.WriteString(`{"method":"`)
	reqBody.WriteString(method)
	reqBody.WriteString(`","urlPath":"`)
	reqBody.WriteString(urlPath)
	reqBody.WriteString(`","headers":{"X-Test-Id":{"equalTo":"`)
	reqBody.WriteString(testId)
	reqBody.WriteString(`"}}`)
	if len(queryParams) > 0 {
		reqBody.WriteString(`,"queryParameters":{`)
		first := true
		for key, value := range queryParams {
			if !first {
				reqBody.WriteString(",")
			}
			reqBody.WriteString(`"`)
			reqBody.WriteString(key)
			reqBody.WriteString(`":{"equalTo":"`)
			reqBody.WriteString(value)
			reqBody.WriteString(`"}`)
			first = false
		}
		reqBody.WriteString("}")
	}
	reqBody.WriteString("}")
	resp, err := http.Post(WiremockAdminURL+"/requests/find", "application/json", &reqBody)
	require.NoError(t, err)
	var result struct {
		Requests []interface{} `json:"requests"`
	}
	json.NewDecoder(resp.Body).Decode(&result)
	require.Equal(t, expected, len(result.Requests))
}

func TestBoardingMerchantPlatformsListWithWireMock(
	t *testing.T,
) {
	WireMockBaseURL := "http://localhost:8080"
	client := client.NewPayrocClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	request := &boarding.ListMerchantPlatformsRequest{
		Before: payroc.String(
			"2571",
		),
		After: payroc.String(
			"8516",
		),
		Limit: payroc.Int(
			1,
		),
	}
	_, invocationErr := client.Boarding.MerchantPlatforms.List(
		context.TODO(),
		request,
		option.WithHTTPHeader(
			http.Header{"X-Test-Id": []string{"TestBoardingMerchantPlatformsListWithWireMock"}},
		),
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	VerifyRequestCount(t, "TestBoardingMerchantPlatformsListWithWireMock", "GET", "/merchant-platforms", map[string]string{"before": "2571", "after": "8516", "limit": "1"}, 1)
}

func TestBoardingMerchantPlatformsCreateWithWireMock(
	t *testing.T,
) {
	WireMockBaseURL := "http://localhost:8080"
	client := client.NewPayrocClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	request := &boarding.CreateMerchantAccount{
		IdempotencyKey: "8e03978e-40d5-43e8-bc93-6894a57f9324",
		Business: &payroc.Business{
			Name:               "Example Corp",
			TaxId:              "12-3456789",
			OrganizationType:   payroc.BusinessOrganizationTypePrivateCorporation,
			CountryOfOperation: payroc.BusinessCountryOfOperationUs.Ptr(),
			Addresses: []*payroc.LegalAddress{
				&payroc.LegalAddress{
					Address1: "1 Example Ave.",
					Address2: payroc.String(
						"Example Address Line 2",
					),
					Address3: payroc.String(
						"Example Address Line 3",
					),
					City:       "Chicago",
					State:      "Illinois",
					Country:    "US",
					PostalCode: "60056",
					Type:       payroc.AddressTypeTypeLegalAddress,
				},
			},
			ContactMethods: []*payroc.ContactMethod{
				&payroc.ContactMethod{
					Email: &payroc.ContactMethodEmail{
						Value: "jane.doe@example.com",
					},
				},
			},
		},
		ProcessingAccounts: []*payroc.CreateProcessingAccount{
			&payroc.CreateProcessingAccount{
				DoingBusinessAs: "Pizza Doe",
				Owners: []*payroc.Owner{
					&payroc.Owner{
						FirstName: "Jane",
						MiddleName: payroc.String(
							"Helen",
						),
						LastName: "Doe",
						DateOfBirth: payroc.MustParseDate(
							"1964-03-22",
						),
						Address: &payroc.Address{
							Address1: "1 Example Ave.",
							Address2: payroc.String(
								"Example Address Line 2",
							),
							Address3: payroc.String(
								"Example Address Line 3",
							),
							City:       "Chicago",
							State:      "Illinois",
							Country:    "US",
							PostalCode: "60056",
						},
						Identifiers: []*payroc.Identifier{
							&payroc.Identifier{
								Type:  payroc.IdentifierTypeNationalId,
								Value: "000-00-4320",
							},
						},
						ContactMethods: []*payroc.ContactMethod{
							&payroc.ContactMethod{
								Email: &payroc.ContactMethodEmail{
									Value: "jane.doe@example.com",
								},
							},
						},
						Relationship: &payroc.OwnerRelationship{
							EquityPercentage: payroc.Float64(
								48.5,
							),
							Title: payroc.String(
								"CFO",
							),
							IsControlProng: true,
							IsAuthorizedSignatory: payroc.Bool(
								false,
							),
						},
					},
				},
				Website: payroc.String(
					"www.example.com",
				),
				BusinessType:             payroc.CreateProcessingAccountBusinessTypeRestaurant,
				CategoryCode:             5999,
				MerchandiseOrServiceSold: "Pizza",
				BusinessStartDate: payroc.MustParseDate(
					"2020-01-01",
				),
				Timezone: payroc.TimezoneAmericaChicago,
				Address: &payroc.Address{
					Address1: "1 Example Ave.",
					Address2: payroc.String(
						"Example Address Line 2",
					),
					Address3: payroc.String(
						"Example Address Line 3",
					),
					City:       "Chicago",
					State:      "Illinois",
					Country:    "US",
					PostalCode: "60056",
				},
				ContactMethods: []*payroc.ContactMethod{
					&payroc.ContactMethod{
						Email: &payroc.ContactMethodEmail{
							Value: "jane.doe@example.com",
						},
					},
				},
				Processing: &payroc.Processing{
					TransactionAmounts: &payroc.ProcessingTransactionAmounts{
						Average: 5000,
						Highest: 10000,
					},
					MonthlyAmounts: &payroc.ProcessingMonthlyAmounts{
						Average: 50000,
						Highest: 100000,
					},
					VolumeBreakdown: &payroc.ProcessingVolumeBreakdown{
						CardPresent:     77,
						MailOrTelephone: 3,
						Ecommerce:       20,
					},
					IsSeasonal: payroc.Bool(
						true,
					),
					MonthsOfOperation: []payroc.ProcessingMonthsOfOperationItem{
						payroc.ProcessingMonthsOfOperationItemJan,
						payroc.ProcessingMonthsOfOperationItemFeb,
					},
					Ach: &payroc.ProcessingAch{
						Naics: payroc.String(
							"5812",
						),
						PreviouslyTerminatedForAch: payroc.Bool(
							false,
						),
						Refunds: &payroc.ProcessingAchRefunds{
							WrittenRefundPolicy: true,
							RefundPolicyUrl: payroc.String(
								"www.example.com/refund-poilcy-url",
							),
						},
						EstimatedMonthlyTransactions: 3000,
						Limits: &payroc.ProcessingAchLimits{
							SingleTransaction: 10000,
							DailyDeposit:      200000,
							MonthlyDeposit:    6000000,
						},
						TransactionTypes: []payroc.ProcessingAchTransactionTypesItem{
							payroc.ProcessingAchTransactionTypesItemPrearrangedPayment,
							payroc.ProcessingAchTransactionTypesItemOther,
						},
						TransactionTypesOther: payroc.String(
							"anotherTransactionType",
						),
					},
					CardAcceptance: &payroc.ProcessingCardAcceptance{
						DebitOnly: payroc.Bool(
							false,
						),
						HsaFsa: payroc.Bool(
							false,
						),
						CardsAccepted: []payroc.ProcessingCardAcceptanceCardsAcceptedItem{
							payroc.ProcessingCardAcceptanceCardsAcceptedItemVisa,
							payroc.ProcessingCardAcceptanceCardsAcceptedItemMastercard,
						},
						SpecialityCards: &payroc.ProcessingCardAcceptanceSpecialityCards{
							AmericanExpressDirect: &payroc.ProcessingCardAcceptanceSpecialityCardsAmericanExpressDirect{
								Enabled: payroc.Bool(
									true,
								),
								MerchantNumber: payroc.String(
									"abc1234567",
								),
							},
							ElectronicBenefitsTransfer: &payroc.ProcessingCardAcceptanceSpecialityCardsElectronicBenefitsTransfer{
								Enabled: payroc.Bool(
									true,
								),
								FnsNumber: payroc.String(
									"6789012",
								),
							},
							Other: &payroc.ProcessingCardAcceptanceSpecialityCardsOther{
								WexMerchantNumber: payroc.String(
									"abc1234567",
								),
								VoyagerMerchantId: payroc.String(
									"abc1234567",
								),
								FleetMerchantId: payroc.String(
									"abc1234567",
								),
							},
						},
					},
				},
				Funding: &payroc.CreateFunding{
					FundingSchedule: payroc.CommonFundingFundingScheduleNextday.Ptr(),
					AcceleratedFundingFee: payroc.Int(
						1999,
					),
					DailyDiscount: payroc.Bool(
						false,
					),
					FundingAccounts: []*payroc.FundingAccount{
						&payroc.FundingAccount{
							Type:          payroc.FundingAccountTypeChecking,
							Use:           payroc.FundingAccountUseCreditAndDebit,
							NameOnAccount: "Jane Doe",
							PaymentMethods: []*payroc.PaymentMethodsItem{
								&payroc.PaymentMethodsItem{
									Ach: &payroc.PaymentMethodAch{},
								},
							},
							Metadata: map[string]string{
								"yourCustomField": "abc123",
							},
						},
					},
				},
				Pricing: &payroc.Pricing{
					Intent: &payroc.PricingTemplate{
						PricingIntentId: "6123",
					},
				},
				Signature: &payroc.Signature{
					RequestedViaDirectLink: &payroc.SignatureByDirectLink{},
				},
				Contacts: []*payroc.Contact{
					&payroc.Contact{
						Type:      payroc.ContactTypeManager,
						FirstName: "Jane",
						MiddleName: payroc.String(
							"Helen",
						),
						LastName: "Doe",
						Identifiers: []*payroc.Identifier{
							&payroc.Identifier{
								Type:  payroc.IdentifierTypeNationalId,
								Value: "000-00-4320",
							},
						},
						ContactMethods: []*payroc.ContactMethod{
							&payroc.ContactMethod{
								Email: &payroc.ContactMethodEmail{
									Value: "jane.doe@example.com",
								},
							},
						},
					},
				},
				Metadata: map[string]string{
					"customerId": "2345",
				},
			},
		},
		Metadata: map[string]string{
			"customerId": "2345",
		},
	}
	_, invocationErr := client.Boarding.MerchantPlatforms.Create(
		context.TODO(),
		request,
		option.WithHTTPHeader(
			http.Header{"X-Test-Id": []string{"TestBoardingMerchantPlatformsCreateWithWireMock"}},
		),
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	VerifyRequestCount(t, "TestBoardingMerchantPlatformsCreateWithWireMock", "POST", "/merchant-platforms", nil, 1)
}

func TestBoardingMerchantPlatformsRetrieveWithWireMock(
	t *testing.T,
) {
	WireMockBaseURL := "http://localhost:8080"
	client := client.NewPayrocClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	request := &boarding.RetrieveMerchantPlatformsRequest{
		MerchantPlatformId: "12345",
	}
	_, invocationErr := client.Boarding.MerchantPlatforms.Retrieve(
		context.TODO(),
		request,
		option.WithHTTPHeader(
			http.Header{"X-Test-Id": []string{"TestBoardingMerchantPlatformsRetrieveWithWireMock"}},
		),
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	VerifyRequestCount(t, "TestBoardingMerchantPlatformsRetrieveWithWireMock", "GET", "/merchant-platforms/12345", nil, 1)
}

func TestBoardingMerchantPlatformsListProcessingAccountsWithWireMock(
	t *testing.T,
) {
	WireMockBaseURL := "http://localhost:8080"
	client := client.NewPayrocClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	request := &boarding.ListBoardingMerchantPlatformProcessingAccountsRequest{
		MerchantPlatformId: "12345",
		Before: payroc.String(
			"2571",
		),
		After: payroc.String(
			"8516",
		),
		Limit: payroc.Int(
			1,
		),
		IncludeClosed: payroc.Bool(
			true,
		),
	}
	_, invocationErr := client.Boarding.MerchantPlatforms.ListProcessingAccounts(
		context.TODO(),
		request,
		option.WithHTTPHeader(
			http.Header{"X-Test-Id": []string{"TestBoardingMerchantPlatformsListProcessingAccountsWithWireMock"}},
		),
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	VerifyRequestCount(t, "TestBoardingMerchantPlatformsListProcessingAccountsWithWireMock", "GET", "/merchant-platforms/12345/processing-accounts", map[string]string{"before": "2571", "after": "8516", "limit": "1", "includeClosed": "true"}, 1)
}

func TestBoardingMerchantPlatformsCreateProcessingAccountWithWireMock(
	t *testing.T,
) {
	WireMockBaseURL := "http://localhost:8080"
	client := client.NewPayrocClient(
		option.WithBaseURL(
			WireMockBaseURL,
		),
	)
	request := &boarding.CreateProcessingAccountMerchantPlatformsRequest{
		MerchantPlatformId: "12345",
		IdempotencyKey:     "8e03978e-40d5-43e8-bc93-6894a57f9324",
		Body: &payroc.CreateProcessingAccount{
			DoingBusinessAs: "Pizza Doe",
			Owners: []*payroc.Owner{
				&payroc.Owner{
					FirstName: "Jane",
					MiddleName: payroc.String(
						"Helen",
					),
					LastName: "Doe",
					DateOfBirth: payroc.MustParseDate(
						"1964-03-22",
					),
					Address: &payroc.Address{
						Address1: "1 Example Ave.",
						Address2: payroc.String(
							"Example Address Line 2",
						),
						Address3: payroc.String(
							"Example Address Line 3",
						),
						City:       "Chicago",
						State:      "Illinois",
						Country:    "US",
						PostalCode: "60056",
					},
					Identifiers: []*payroc.Identifier{
						&payroc.Identifier{
							Type:  payroc.IdentifierTypeNationalId,
							Value: "000-00-4320",
						},
					},
					ContactMethods: []*payroc.ContactMethod{
						&payroc.ContactMethod{
							Email: &payroc.ContactMethodEmail{
								Value: "jane.doe@example.com",
							},
						},
					},
					Relationship: &payroc.OwnerRelationship{
						EquityPercentage: payroc.Float64(
							51.5,
						),
						Title: payroc.String(
							"CFO",
						),
						IsControlProng: true,
						IsAuthorizedSignatory: payroc.Bool(
							false,
						),
					},
				},
			},
			Website: payroc.String(
				"www.example.com",
			),
			BusinessType:             payroc.CreateProcessingAccountBusinessTypeRestaurant,
			CategoryCode:             5999,
			MerchandiseOrServiceSold: "Pizza",
			BusinessStartDate: payroc.MustParseDate(
				"2020-01-01",
			),
			Timezone: payroc.TimezoneAmericaChicago,
			Address: &payroc.Address{
				Address1: "1 Example Ave.",
				Address2: payroc.String(
					"Example Address Line 2",
				),
				Address3: payroc.String(
					"Example Address Line 3",
				),
				City:       "Chicago",
				State:      "Illinois",
				Country:    "US",
				PostalCode: "60056",
			},
			ContactMethods: []*payroc.ContactMethod{
				&payroc.ContactMethod{
					Email: &payroc.ContactMethodEmail{
						Value: "jane.doe@example.com",
					},
				},
			},
			Processing: &payroc.Processing{
				TransactionAmounts: &payroc.ProcessingTransactionAmounts{
					Average: 5000,
					Highest: 10000,
				},
				MonthlyAmounts: &payroc.ProcessingMonthlyAmounts{
					Average: 50000,
					Highest: 100000,
				},
				VolumeBreakdown: &payroc.ProcessingVolumeBreakdown{
					CardPresent:     77,
					MailOrTelephone: 3,
					Ecommerce:       20,
				},
				IsSeasonal: payroc.Bool(
					true,
				),
				MonthsOfOperation: []payroc.ProcessingMonthsOfOperationItem{
					payroc.ProcessingMonthsOfOperationItemJan,
					payroc.ProcessingMonthsOfOperationItemFeb,
				},
				Ach: &payroc.ProcessingAch{
					Naics: payroc.String(
						"5812",
					),
					PreviouslyTerminatedForAch: payroc.Bool(
						false,
					),
					Refunds: &payroc.ProcessingAchRefunds{
						WrittenRefundPolicy: true,
						RefundPolicyUrl: payroc.String(
							"www.example.com/refund-poilcy-url",
						),
					},
					EstimatedMonthlyTransactions: 3000,
					Limits: &payroc.ProcessingAchLimits{
						SingleTransaction: 10000,
						DailyDeposit:      200000,
						MonthlyDeposit:    6000000,
					},
					TransactionTypes: []payroc.ProcessingAchTransactionTypesItem{
						payroc.ProcessingAchTransactionTypesItemPrearrangedPayment,
						payroc.ProcessingAchTransactionTypesItemOther,
					},
					TransactionTypesOther: payroc.String(
						"anotherTransactionType",
					),
				},
				CardAcceptance: &payroc.ProcessingCardAcceptance{
					DebitOnly: payroc.Bool(
						false,
					),
					HsaFsa: payroc.Bool(
						false,
					),
					CardsAccepted: []payroc.ProcessingCardAcceptanceCardsAcceptedItem{
						payroc.ProcessingCardAcceptanceCardsAcceptedItemVisa,
						payroc.ProcessingCardAcceptanceCardsAcceptedItemMastercard,
					},
					SpecialityCards: &payroc.ProcessingCardAcceptanceSpecialityCards{
						AmericanExpressDirect: &payroc.ProcessingCardAcceptanceSpecialityCardsAmericanExpressDirect{
							Enabled: payroc.Bool(
								true,
							),
							MerchantNumber: payroc.String(
								"abc1234567",
							),
						},
						ElectronicBenefitsTransfer: &payroc.ProcessingCardAcceptanceSpecialityCardsElectronicBenefitsTransfer{
							Enabled: payroc.Bool(
								true,
							),
							FnsNumber: payroc.String(
								"6789012",
							),
						},
						Other: &payroc.ProcessingCardAcceptanceSpecialityCardsOther{
							WexMerchantNumber: payroc.String(
								"abc1234567",
							),
							VoyagerMerchantId: payroc.String(
								"abc1234567",
							),
							FleetMerchantId: payroc.String(
								"abc1234567",
							),
						},
					},
				},
			},
			Funding: &payroc.CreateFunding{
				FundingSchedule: payroc.CommonFundingFundingScheduleNextday.Ptr(),
				AcceleratedFundingFee: payroc.Int(
					1999,
				),
				DailyDiscount: payroc.Bool(
					false,
				),
				FundingAccounts: []*payroc.FundingAccount{
					&payroc.FundingAccount{
						Type:          payroc.FundingAccountTypeChecking,
						Use:           payroc.FundingAccountUseCreditAndDebit,
						NameOnAccount: "Jane Doe",
						PaymentMethods: []*payroc.PaymentMethodsItem{
							&payroc.PaymentMethodsItem{
								Ach: &payroc.PaymentMethodAch{},
							},
						},
						Metadata: map[string]string{
							"yourCustomField": "abc123",
						},
					},
				},
			},
			Pricing: &payroc.Pricing{
				Intent: &payroc.PricingTemplate{
					PricingIntentId: "6123",
				},
			},
			Signature: &payroc.Signature{
				RequestedViaDirectLink: &payroc.SignatureByDirectLink{},
			},
			Contacts: []*payroc.Contact{
				&payroc.Contact{
					Type:      payroc.ContactTypeManager,
					FirstName: "Jane",
					MiddleName: payroc.String(
						"Helen",
					),
					LastName: "Doe",
					Identifiers: []*payroc.Identifier{
						&payroc.Identifier{
							Type:  payroc.IdentifierTypeNationalId,
							Value: "000-00-4320",
						},
					},
					ContactMethods: []*payroc.ContactMethod{
						&payroc.ContactMethod{
							Email: &payroc.ContactMethodEmail{
								Value: "jane.doe@example.com",
							},
						},
					},
				},
			},
			Metadata: map[string]string{
				"customerId": "2345",
			},
		},
	}
	_, invocationErr := client.Boarding.MerchantPlatforms.CreateProcessingAccount(
		context.TODO(),
		request,
		option.WithHTTPHeader(
			http.Header{"X-Test-Id": []string{"TestBoardingMerchantPlatformsCreateProcessingAccountWithWireMock"}},
		),
	)

	require.NoError(t, invocationErr, "Client method call should succeed")
	VerifyRequestCount(t, "TestBoardingMerchantPlatformsCreateProcessingAccountWithWireMock", "POST", "/merchant-platforms/12345/processing-accounts", nil, 1)
}
