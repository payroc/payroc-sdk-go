// Code generated by Fern. DO NOT EDIT.

package client

import (
	context "context"
	errors "errors"

	payroc "github.com/payroc/payroc-sdk-go"
	applepaysessions "github.com/payroc/payroc-sdk-go/applepaysessions"
	attachments "github.com/payroc/payroc-sdk-go/attachments"
	auth "github.com/payroc/payroc-sdk-go/auth"
	banktransferpaymentsclient "github.com/payroc/payroc-sdk-go/banktransferpayments/client"
	boardingclient "github.com/payroc/payroc-sdk-go/boarding/client"
	cardpaymentsclient "github.com/payroc/payroc-sdk-go/cardpayments/client"
	core "github.com/payroc/payroc-sdk-go/core"
	fundingclient "github.com/payroc/payroc-sdk-go/funding/client"
	hostedfields "github.com/payroc/payroc-sdk-go/hostedfields"
	internal "github.com/payroc/payroc-sdk-go/internal"
	notificationsclient "github.com/payroc/payroc-sdk-go/notifications/client"
	option "github.com/payroc/payroc-sdk-go/option"
	paymentfeaturesclient "github.com/payroc/payroc-sdk-go/paymentfeatures/client"
	client "github.com/payroc/payroc-sdk-go/paymentlinks/client"
	payroccloudclient "github.com/payroc/payroc-sdk-go/payroccloud/client"
	repeatpaymentsclient "github.com/payroc/payroc-sdk-go/repeatpayments/client"
	reportingclient "github.com/payroc/payroc-sdk-go/reporting/client"
	tokenizationclient "github.com/payroc/payroc-sdk-go/tokenization/client"
)

type PayrocClient struct {
	PaymentLinks         *client.Client
	HostedFields         *hostedfields.Client
	ApplePaySessions     *applepaysessions.Client
	Attachments          *attachments.Client
	Auth                 *auth.Client
	Funding              *fundingclient.Client
	BankTransferPayments *banktransferpaymentsclient.Client
	Boarding             *boardingclient.Client
	CardPayments         *cardpaymentsclient.Client
	Notifications        *notificationsclient.Client
	PaymentFeatures      *paymentfeaturesclient.Client
	PayrocCloud          *payroccloudclient.Client
	RepeatPayments       *repeatpaymentsclient.Client
	Reporting            *reportingclient.Client
	Tokenization         *tokenizationclient.Client

	options *core.RequestOptions
	baseURL string
	caller  *internal.Caller
}

func NewPayrocClient(opts ...option.RequestOption) *PayrocClient {
	options := core.NewRequestOptions(opts...)
	inferredAuthProvider := core.NewInferredAuthProvider()
	authOptions := *options
	authClient := auth.NewClient(
		&authOptions,
	)
	options.SetTokenGetter(func() (string, error) {
		return inferredAuthProvider.GetOrFetch(func() (string, int, error) {
			response, err := authClient.RetrieveToken(context.Background(), &payroc.RetrieveTokenAuthRequest{
				ApiKey: options.ApiKey,
			})
			if err != nil {
				return "", 0, err
			}
			if response.AccessToken == "" {
				return "", 0, errors.New(
					"oauth response missing access token",
				)
			}
			expiresIn := 0
			if response.ExpiresIn > 0 {
				expiresIn = response.ExpiresIn
			}
			return response.AccessToken, expiresIn, nil
		})
	})
	return &PayrocClient{
		PaymentLinks:         client.NewClient(options),
		HostedFields:         hostedfields.NewClient(options),
		ApplePaySessions:     applepaysessions.NewClient(options),
		Attachments:          attachments.NewClient(options),
		Auth:                 auth.NewClient(options),
		Funding:              fundingclient.NewClient(options),
		BankTransferPayments: banktransferpaymentsclient.NewClient(options),
		Boarding:             boardingclient.NewClient(options),
		CardPayments:         cardpaymentsclient.NewClient(options),
		Notifications:        notificationsclient.NewClient(options),
		PaymentFeatures:      paymentfeaturesclient.NewClient(options),
		PayrocCloud:          payroccloudclient.NewClient(options),
		RepeatPayments:       repeatpaymentsclient.NewClient(options),
		Reporting:            reportingclient.NewClient(options),
		Tokenization:         tokenizationclient.NewClient(options),
		options:              options,
		baseURL:              options.BaseURL,
		caller: internal.NewCaller(
			&internal.CallerParams{
				Client:      options.HTTPClient,
				MaxAttempts: options.MaxAttempts,
			},
		),
	}
}
